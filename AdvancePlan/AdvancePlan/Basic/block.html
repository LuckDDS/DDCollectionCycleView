<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="base.css">
    <title>Document</title>
</head>
<body>
    <div class="back">
        <div class="header">Block</div>
        <h3>Blockå®šä¹‰</h3>
        <p><code>1.Blockæ ¼å¼</code></p>
        <pre><code>
//ç­‰å·å·¦ä¾§æ˜¯å£°æ˜ä¸€ä¸ªblock,å³ä¾§æ˜¯å®šä¹‰ä¸€ä¸ªblock
(1).å®šä¹‰blockå—å¿…é¡»ä»¥^å¼€å¤´,å£°æ˜å—ä»¥è¿”å›å€¼ç±»å‹å¼€å¤´
(2).å®šä¹‰å—çš„è¿”å›å€¼ç±»å‹å¯ä»¥çœç•¥,è€Œä¸”ç»å¸¸ä¼šçœç•¥,å£°æ˜ä¸èƒ½çœç•¥
(3).å®šä¹‰å—æ— éœ€æŒ‡å®šåå­—,å£°æ˜å—å¿…é¡»å¾—æœ‰
(4).å¦‚æœå—æ²¡æœ‰å‚æ•°,å‚æ•°éƒ¨åˆ†å¯ä»¥çœç•¥ä½†æ˜¯å‚æ•°éƒ¨åˆ†çš„æ‹¬å·ä¸èƒ½çœç•¥,
ä½†æ˜¯å†…éƒ¨å¯ä»¥ç•™ç©º,é€šå¸¸å»ºè®®ä½¿ç”¨voidä½œä¸ºå ä½ç¬¦

returnType(^blockName)(parameterTypes) = ^(parameters) {
    statements
};

void(^blockName)(NSString *) = ^void(NSString*str){
    NSLog(@"%@",str);
};
blockName(@"è¿™æ˜¯ä¸€ä¸ªç®€å•çš„æ— è¿”å›å€¼çš„block");

//^å‘Šè¯‰è®¡ç®—æœºè¿™æ˜¯ä¸€ä¸ªblock
NSString *(^blockParam)(NSString *) = ^NSString*(NSString*n){
    NSLog(@"%@",n);
    return @"123456789";
};
NSString * str = blockParam(@"è¿™æ˜¯ä¸€ä¸ªç®€å•çš„å¸¦è¿”å›å€¼çš„block");
str = @"123456789";

        </code></pre>
        <p><code>2.Blockä½œä¸ºå±æ€§</code></p>
        <pre><code>
@property(nonatomic,copy) void (^propertyBlock)(NSString*);

</code></pre>
        <p><code>3.typedefå®šä¹‰Block</code></p>
        <pre><code>
typedef void (^typedefBlock)(NSString *);
@property(nonatomic, copy)typedefBlock block;

</code></pre>
        <p><code>4.Blockä½œä¸ºå‚æ•°ä¸å¸¦è¿”å›å€¼</code></p>
        <pre><code>
- (void)viewDidLoad{
    [self blockAsParam:^(NSString *name) {
        NSLog(@"%@",name);//123123123
    }];
}
- (void)blockAsParam:(void (^)(NSString * _Nullable))paramBlock{
    paramBlock(@"123123123");
}
    </code></pre>
    <p><code>5.Blockä½œä¸ºå‚æ•°å¸¦è¿”å›å€¼</code></p>
    <pre><code>
- (void)viewDidLoad{

    [self blockAsParamReturnValue:^NSString*(NSString *name){
        NSLog(@"%@",name);
        return @"123123123123";
    }];

}

- (void)blockAsParamReturnValue:(NSString *(^)(NSString *str))returnValue{

    NSString *s = returnValue(@"123123123");
    NSLog(@"%@",s);//123123123123

}
    </code></pre>
    <p><code>6.Blockä¸å¸¦è¿”å›å€¼,ä½œä¸ºè¿”å›å€¼</code></p>
    <pre><code>
- (void)viewDidLoad{

    void(^blockNoReturn)(NSString*) = [self blockNoReturnValue:@"11111"];
    blockNoReturn(@"000000");
}

- (void(^)(NSString *))blockNoReturnValue:(NSString*)value{

    return ^(NSString *name){
        NSLog(@"%@,%@",name,value);//000000,11111
    };

}
    </code></pre>
    <p><code>7.Blockå¸¦è¿”å›å€¼,ä½œä¸ºè¿”å›å€¼</code></p>
    <pre><code>
- (void)viewDidLoad{

    NSString *(^haveReturnValue)(NSString *) = [self blockHaveReturnValue:@"2222"];
    NSString *s = haveReturnValue(@"123");
    NSLog(@"%@",s);//11111111111111111111

}

- (NSString *(^)(NSString*))blockHaveReturnValue:(NSString*)value{

    return ^NSString *(NSString*n){
        NSLog(@"%@,%@",n,value);//123,2222
        return @"11111111111111111111"
    };

}
    </code></pre>
<h3>Blockè¯¦è§£</h3>
    <p><code>1.ä½¿ç”¨copyå’Œstrongä¿®é¥°blockæœ‰ä»€ä¹ˆåŒºåˆ«å—?</code></p>
    <pre><code>
blockæœ‰ä¸‰ç§å­˜å‚¨ç±»å‹__NSGlobalBlock__,__NSStackBlock__, __NSMallocBlock__.

ç»æµ‹è¯•åœ¨MRCç¯å¢ƒä¸‹,ä»»ä½•ä½ç½®å®šä¹‰çš„block,æœªå¼•ç”¨å¤–éƒ¨å˜é‡çš„æƒ…å†µä¸‹ä¸ºNSGlobalBlockç±»å‹.
å¼•ç”¨äº†å¤–éƒ¨é™æ€å˜é‡(å…¨å±€/å±€éƒ¨)çš„ä¸ºNSGlobalBlock,å¼•ç”¨äº†å¤–éƒ¨éé™æ€å˜é‡(å…¨å±€/å±€éƒ¨)çš„,
å¦‚æœä½¿ç”¨copyä¿®é¥°äº†å±æ€§å¹¶ä¸”ä½¿ç”¨äº†self.è¯­æ³•è°ƒç”¨çš„ä¸ºNSMallocBlock,å¦åˆ™æ˜¯NSStackBlockç±»å‹.
(ä¸¾ä¾‹@property (nonatomic ,copy) void (^copyPropertyBlock)(NSString * _Nullable);
   
    self.copyPropertyBlock = ^(NSString *c){
        int d = globaln + 9;
    };//globalnä¸ºéé™æ€å˜é‡,è¿™ä¸ªæ—¶å€™copyPropertyBlockç±»å‹æ˜¯NSMallocBlock
)
åœ¨ä»¥ä¸Šçš„åŸºç¡€ä¸Šå¯¹æ‰€æœ‰çš„blockæ‰§è¡Œcopyæ“ä½œ,NSGlobalBlockçš„blockä¿æŒåŸçŠ¶,
NSStackBlockç±»å‹çš„blockå˜ä¸ºNSMallocBlock,æ‹·è´åˆ°äº†å †ä¸Š.æ‰€ä»¥åœ¨MRCä¸­éœ€è¦ä½¿ç”¨copyä¿®é¥°
å¦åˆ™åœ¨æ ˆä¸­ä¼šéšæ—¶é‡Šæ”¾

åœ¨ARCç¯å¢ƒä¸‹ä»»ä½•ä½ç½®å®šä¹‰çš„block,æœªå¼•ç”¨å¤–éƒ¨å˜é‡çš„æƒ…å†µä¸‹ä¸ºNSGlobalBlockç±»å‹,
å¼•ç”¨äº†å¤–éƒ¨é™æ€å˜é‡(å…¨å±€/å±€éƒ¨)çš„ä¸ºNSGlobalBlock,å¼•ç”¨äº†å¤–éƒ¨éé™æ€å˜é‡(å…¨å±€/å±€éƒ¨)çš„ä¸ºNSMallocBlock
åœ¨ä»¥ä¸Šçš„åŸºç¡€ä¸Šå¯¹æ‰€æœ‰çš„blockæ‰§è¡Œcopyæ“ä½œ,NSGlobalBlockçš„blockä¿æŒåŸçŠ¶,
NSMallocBlockçš„ç±»å‹æœªå˜åŒ–(åœ°å€ä¹Ÿæœªå‘ç”Ÿå˜åŒ–)

ç»“è®º
åœ¨MRCä¸­è®¿é—®å¤–éƒ¨éé™æ€å˜é‡çš„blockå¿…é¡»éœ€è¦ä½¿ç”¨copyå¯¹blockè¿›è¡Œä¿®é¥°,å°†å…¶æ‹·è´åˆ°å †ä¸­.
ARCä¸­ç³»ç»Ÿä»¥åŠå¸®æˆ‘ä»¬æ‹·è´åˆ°å †äº†,æ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦åœ¨è¿›è¡Œcopyå¤„ç†,ä½¿ç”¨copyæˆ–è€…strongä¿®é¥°éƒ½å¯ä»¥.

ç½‘ä¸Šä¸€æœå¥½å¤šå…³äºè¿™æ–¹é¢çš„è®²è§£,ä½†æ˜¯å¤§å¤šæ•°éƒ½æ˜¯å¤åˆ¶çš„ä¸€ç¯‡æ–‡ç« ,å†…å®¹éƒ½ä¸€æ ·,
è€Œä¸”è¿˜æ˜¯æ¯”è¾ƒè€çš„æ–‡ç« ,æ²¡æœ‰æ¶‰åŠARCå’ŒMRCçš„å¯¹æ¯”,å½“ç„¶ä¹Ÿæœ‰å¥½çš„æ–‡ç« ,å»ºè®®å¤§å®¶è‡ªå·±è¯•ä¸€ä¸‹æ‰ä¼šçŸ¥é“ç»“æœ.

    </code></pre>
<p><code>2.Blockæ•è·å˜é‡</code></p>
<pre><code>
#include "DDBlockStudy.h"
//å…¨å±€çš„
int w = 23;
static int e = 10;
int f[] = {11,22,33,44};

void buildBlock(){
    
    int m = 1;
    static int n = 3;
    int arr[] = {1,2,3,4,5,6};
    
    void (^testBlock)(int)= ^(int d){
        printf("\n%d,%d,%d,%d,%d\n", w,e,*f,m,n);
        //æ‰“å°çš„ç»“æœæ˜¯12,14,32,1,10
    };
    w = 12;
    e = 14;
    *f = 32;
    m = 4;
    n = 10;
    testBlock(3);
    
}
ä¸Šé¢çš„å†…å®¹å‡ºç°çš„ç»“æœå¯ä»¥æ€»ç»“ä¸€ä¸‹
(1).å¯¹äºå±€éƒ¨éé™æ€å˜é‡blockæ•è·çš„æ˜¯å€¼.
(2).å¯¹äºå±€éƒ¨é™æ€å˜é‡blockæ•è·çš„æ˜¯æŒ‡é’ˆ.
(3).å…¨å±€çš„å˜é‡å¹¶æ²¡æœ‰è¿›è¡Œæ•è·ç”¨çš„æ—¶å€™æ˜¯ç›´æ¥å–çš„.
(4).å…¨å±€å˜é‡å¹¶æœªè¿›è¡Œæ•è·,ç”¨çš„æ—¶å€™ç›´æ¥å–ç”¨,ä½†æ˜¯æˆå‘˜å˜é‡å’Œå±æ€§ä¼šæ•è·ä»–ä»¬çš„æŒæœ‰è€…(3.Blockä¿®æ”¹å˜é‡æœ‰è§£è¯´)(2020,3,20è¡¥å……)
ç†ç”±è§ static void __buildBlock_block_func_0(struct __buildBlock_block_impl_0 *__cself, int d);å‡½æ•°
(è¡¥å……,æ›´ç¡®åˆ‡çš„è¯´æ˜¯åœ¨__buildBlock_block_impl_0((void *)__buildBlock_block_func_0, &__buildBlock_block_desc_0_DATA, m, &n)å‡½æ•°ä¸­å¯ä»¥çœ‹å‡º,è¯¦ç»†è§ä¸‹é¢çš„ğŸ‘‡Blockä¿®æ”¹å˜é‡æœ‰è§£è¯´)



//é€šè¿‡æºç åˆ†æ
int w = 23;
static int e = 10;
int f[] = {11,22,33,44};

//è¿™æ˜¯blockçš„å®šä¹‰æ¥è‡ª__buildBlock_block_impl_0((void *)__buildBlock_block_func_0, &__buildBlock_block_desc_0_DATA, m, &n)
struct __buildBlock_block_impl_0 {
  struct __block_impl impl;
  struct __buildBlock_block_desc_0* Desc;
  //ä¸‹é¢çš„å†…å®¹æ˜¯è¢«æ•è·çš„å‚æ•°
  int m;
  int *n;

  //void *fp å¯¹åº” (void *)__buildBlock_block_func_0 æ–¹æ³•çš„æŒ‡é’ˆ
  //struct __buildBlock_block_desc_0 *desc å¯¹åº”  &__buildBlock_block_desc_0_DATA è¿™ä¸ªblockçš„ä¸€äº›å‚æ•°
  //impl.isa = &_NSConcreteStackBlock;å¯ä»¥å¾—å‡ºå½“å‰çš„blockåœ¨æ ˆä¸­
  //m(_m)å°†_mçš„å€¼èµ‹ç»™m,nåŒç†

  //ä»è¿™é‡Œçœ‹å‡º(int _m, int *_n)è¿™ä¸ªæ—¶å€™må’Œnè¢«æ•è·äº†,ä½†æ˜¯måªæ˜¯å€¼è¢«æŒæœ‰äº†,nè¢«æŒæœ‰çš„æ˜¯æŒ‡é’ˆ.  
  __buildBlock_block_impl_0(void *fp, struct __buildBlock_block_desc_0 *desc, int _m, int *_n, int flags=0) : m(_m), n(_n) {
    impl.isa = &_NSConcreteStackBlock;
    impl.Flags = flags;
    impl.FuncPtr = fp;
    Desc = desc;
  }
};
//ä¸‹é¢çš„è¿™ä¸ªå‡½æ•°å­˜å‚¨çš„æ˜¯blockæ‰§è¡Œçš„ä»£ç 
static void __buildBlock_block_func_0(struct __buildBlock_block_impl_0 *__cself, int d) {
  int m = __cself->m; // bound by copy
  int *n = __cself->n; // bound by copy

        printf("\n%d,%d,%d,%d,%d\n", w,e,*f,m,(*n));
}

static struct __buildBlock_block_desc_0 {
  size_t reserved;
  size_t Block_size;
} __buildBlock_block_desc_0_DATA = { 0, sizeof(struct __buildBlock_block_impl_0)};
void buildBlock(){

    int m = 1;
    static int n = 3;
    int arr[] = {1,2,3,4,5,6};

    void (*testBlock)(int) = ((void (*)(int))&__buildBlock_block_impl_0((void *)__buildBlock_block_func_0, &__buildBlock_block_desc_0_DATA, m, &n));
    w = 12;
    e = 14;
    *f = 32;
    m = 4;
    n = 10;
    //è¿™é‡Œæ˜¯è°ƒç”¨äº†è¿™ä¸ªblock
    ((void (*)(__block_impl *, int))((__block_impl *)testBlock)->FuncPtr)((__block_impl *)testBlock, 3);

}

</code></pre>
<p><code>3.Blockä¿®æ”¹å˜é‡</code></p>
<pre><code>
å…ˆä¸Šä»£ç 
#import "DDBlockController.h"

@interface DDBlockController ()
@property (nonatomic, assign) int a;
@property (nonatomic, copy) NSString *str;
@end

static int b = 11;
int c = 10;
NSString *str1 = @"aaaaaa";
static NSString *str2 = @"bbbbbb";


@implementation DDBlockController
{
    int d;
    NSString *str3;
    void (^testTwo)(void);
    
}
- (void)viewDidLoad {
    [super viewDidLoad];
    
    self.a = 123;
    self.str = @"eeeeeeeee";
    d = 4444444;
    str3 = @"rrrrrrrrrrrrrrrrr";
    [self blockTest];
    // Do any additional setup after loading the view.
}

- (void)blockTest{
    int e = 10;
    static int f = 12;
    NSString * str4= [[NSString alloc]init];;
    str4 = @"123123";
    static NSString * str5= @"1234asdads";

    void (^testOne)(void) = ^(void){
        
        NSLog(@"%d",_a);
        NSLog(@"%d",b);
        NSLog(@"%d",c);
        NSLog(@"%d",d);
        NSLog(@"%d",e);
        NSLog(@"%d",f);
        NSLog(@"%@",_str);
        NSLog(@"%@",str1);
        NSLog(@"%@",str3);
        NSLog(@"%@",str4);
        NSLog(@"%@",str5);

        
    };
    testOne();
}

- (void)dealloc{
    NSLog(@"aaaaaaaaaaaaaa");
}
/*
#pragma mark - Navigation

// In a storyboard-based application, you will often want to do a little preparation before navigation
- (void)prepareForSegue:(UIStoryboardSegue *)segue sender:(id)sender {
    // Get the new view controller using [segue destinationViewController].
    // Pass the selected object to the new view controller.
}
*/

@end

//*descå’Œflagsä¹‹é—´çš„æ˜¯è¢«æ•è·çš„å†…å®¹,self(_self)å°†_selfèµ‹å€¼ç»™self,  DDBlockController *self = __cself->self; // bound by copy,ä»__DDBlockController__blockTest_block_impl_0ä¸­å–å‡ºselfçš„å€¼(C++->å–å€¼ç¬¦å·)
__DDBlockController__blockTest_block_impl_0(void *fp, struct __DDBlockController__blockTest_block_desc_0 *desc, DDBlockController *_self, int flags=0) : self(_self) {



å°†blockä¸­çš„æ‰“å°ä¾æ¬¡æ‰“å¼€,ä»æºç ä¸­å¯ä»¥çœ‹å‡º(æ³¨æ•è·çš„æ„æ€å°±æ˜¯æŒæœ‰çš„æ„æ€)
(1).ä½¿ç”¨å½“å‰ç±»å±æ€§çš„æ—¶å€™self.aæ—¶,ä¼šå°†æŒæœ‰açš„å¯¹è±¡selfæ•è·,å¯ä»¥ä¿®æ”¹å€¼,ä½†æ˜¯æ³¨æ„å¾ªç¯å¼•ç”¨(DDBlockController *_self)
__DDBlockController__blockTest_block_impl_0(void *fp, struct __DDBlockController__blockTest_block_desc_0 *desc, DDBlockController *_self, int flags=0) : self(_self) {

(2).å½“ä½¿ç”¨å…¨å±€é™æ€å˜é‡bçš„æ—¶å€™æœªæ•è·ä»»ä½•å€¼,ç”¨çš„æ—¶å€™ç›´æ¥ä½¿ç”¨,å¯ä»¥ä¿®æ”¹å€¼
__DDBlockController__blockTest_block_impl_0(void *fp, struct __DDBlockController__blockTest_block_desc_0 *desc, int flags=0) {

(3).å½“ä½¿ç”¨å…¨å±€å˜é‡cçš„æ—¶å€™æœªæ•è·ä»»ä½•å€¼,ç”¨çš„æ—¶å€™ç›´æ¥å–,å¯ä»¥ä¿®æ”¹å€¼
__DDBlockController__blockTest_block_impl_0(void *fp, struct __DDBlockController__blockTest_block_desc_0 *desc, int flags=0) {
    
(4).å½“ä½¿ç”¨æˆå‘˜å˜é‡dçš„æ˜¯,æ•è·çš„æ˜¯å¯¹å…¶æŒæœ‰çš„self,å¯ä»¥ä¿®æ”¹å…¶å€¼,ä½†æ˜¯æ³¨æ„å¾ªç¯å¼•ç”¨é—®é¢˜(DDBlockController *_self)
__DDBlockController__blockTest_block_impl_0(void *fp, struct __DDBlockController__blockTest_block_desc_0 *desc, DDBlockController *_self, int flags=0) : self(_self) {

(5).å½“ä½¿ç”¨å±€éƒ¨å˜é‡eçš„æ—¶å€™ä¼šæ•è·å…¶å€¼,æœªæ•è·å…¶æŒ‡é’ˆåœ°å€,ä¸å¯ä¿®æ”¹å€¼é™¤éä½¿ç”¨__blockä¿®é¥°(int _e)
__DDBlockController__blockTest_block_impl_0(void *fp, struct __DDBlockController__blockTest_block_desc_0 *desc, int _e, int flags=0) : e(_e) {

(6).å½“ä½¿ç”¨å±€éƒ¨é™æ€å˜é‡fçš„æ—¶å€™,æ•è·çš„æ˜¯fçš„æŒ‡é’ˆ,å¯ä»¥è¿›è¡Œä¿®æ”¹(int *_f,)
__DDBlockController__blockTest_block_impl_0(void *fp, struct __DDBlockController__blockTest_block_desc_0 *desc, int *_f, int flags=0) : f(_f) {

(7).å½“ä½¿ç”¨å…¨å±€çš„å±æ€§self.stræ—¶,æ•è·çš„æ˜¯æŒæœ‰strçš„å¯¹è±¡self,å¯ä»¥ä¿®æ”¹å€¼,ä½†æ˜¯æ³¨æ„å¾ªç¯å¼•ç”¨(DDBlockController *_self)
__DDBlockController__blockTest_block_impl_0(void *fp, struct __DDBlockController__blockTest_block_desc_0 *desc, DDBlockController *_self, int flags=0) : self(_self) {

(8).å½“ä½¿ç”¨å…¨å±€å˜é‡str1çš„æ—¶å€™,æœªæ•è·ä»»ä½•å€¼,å› æ­¤å¯ä»¥ç›´æ¥ä½¿ç”¨ä¸”å¯ä»¥ä¿®æ”¹å€¼
__DDBlockController__blockTest_block_impl_0(void *fp, struct __DDBlockController__blockTest_block_desc_0 *desc, int flags=0) {

(9).å½“ä½¿ç”¨æˆå‘˜å˜é‡dçš„æ˜¯,æ•è·çš„æ˜¯å¯¹å…¶æŒæœ‰çš„self,å¯ä»¥ä¿®æ”¹å…¶å€¼,ä½†æ˜¯æ³¨æ„å¾ªç¯å¼•ç”¨é—®é¢˜(DDBlockController *_self)
__DDBlockController__blockTest_block_impl_0(void *fp, struct __DDBlockController__blockTest_block_desc_0 *desc, DDBlockController *_self, int flags=0) : self(_self) {

(10).å½“ä½¿ç”¨å±€éƒ¨å˜é‡str4çš„æ—¶å€™,æ•è·çš„æ˜¯str4çš„å€¼å¹¶æ²¡æœ‰æ•è·å…¶æŒ‡é’ˆåœ°å€,æ‰€ä»¥ä¸å¯ä¿®æ”¹,é™¤éä½¿ç”¨__blockä¿®é¥°(NSString *_str4)
__DDBlockController__blockTest_block_impl_0(void *fp, struct __DDBlockController__blockTest_block_desc_0 *desc, NSString *_str4, int flags=0) : str4(_str4) {

(11).å½“ä½¿ç”¨å±€éƒ¨é™æ€å˜é‡str5çš„æ—¶å€™,æ•è·çš„æ˜¯str5çš„åœ°å€,æ‰€ä»¥å¯ä»¥ä¿®æ”¹(NSString **_str5)
__DDBlockController__blockTest_block_impl_0(void *fp, struct __DDBlockController__blockTest_block_desc_0 *desc, NSString **_str5, int flags=0) : str5(_str5) {


æ€»ç»“
//autoå˜é‡(å±€éƒ¨éé™æ€å˜é‡)æ•è·çš„æ˜¯å€¼æ‰€ä»¥ä¸èƒ½æ“ä½œä¿®æ”¹å€¼.
//æ³¨æ„å› ä¸ºå½“å‰çš„blockæ˜¯å±€éƒ¨çš„å¹¶æœªè¢«selfæŒæœ‰,æ‰€ä»¥ä½¿ç”¨selfä¸ä¼šå¼•èµ·å¾ªç¯å¼•ç”¨
//__blockçš„ä½œç”¨æ˜¯å°†ä¿®é¥°çš„å˜é‡åŒ…è£…æˆä¸€ä¸ªç»“æ„ä½“å¯¹è±¡,ä¸¾ä¾‹
ä¸‹é¢çš„è¿™ä¸ªæ˜¯__blockä¿®é¥°çš„int e;è¢«blockæ•è·çš„å,ç³»ç»Ÿä¸ºå…¶åˆ›å»ºçš„ä¸€ä¸ªç»“æ„ä½“
struct __Block_byref_e_0 {
    void *__isa;
  __Block_byref_e_0 *__forwarding;//__forwardingæŒ‡å‘çš„æ˜¯__Block_byref_e_0è‡ªå·±,è‡ªå·±æŒ‡å‘äº†è‡ªå·±
   int __flags;
   int __size;
   int e;
  };
  
//å¯¹äºå¯å˜å˜é‡(NSMutableArray,NSMutableStringç­‰)å³ä½¿æ˜¯å±€éƒ¨å˜é‡ä¹Ÿå¯ä»¥è¿›è¡Œå¢åˆ æ”¹æŸ¥çš„æ“ä½œ,
//å› ä¸ºå¯å˜å†…å®¹åœ¨åˆå§‹è¯çš„æ—¶å€™åˆ†é…äº†ä¸€å—å†…å­˜,æ“ä½œçš„æ—¶å€™éƒ½æ˜¯åœ¨è¿™å—å†…å­˜æ“ä½œçš„,åªè¦æ˜¯ä¸æ”¹å˜è¯¥å˜é‡çš„æŒ‡é’ˆå¯¹åº”çš„å†…å®¹å³å¯


æ€»ç»“ä¸€ä¸‹å°±æ˜¯å¯¹äºå±€éƒ¨éé™æ€å˜é‡è€Œè¨€,å¯ä»¥ä¿®æ”¹å±€éƒ¨å˜é‡çš„å±æ€§ç­‰æ“ä½œ,ä½†æ˜¯ä¸èƒ½æ”¹å˜å…¶æŒ‡å‘çš„å†…å­˜çš„åœ°å€,å¦åˆ™å°±ä¼šæŠ¥é”™,
ä½¿ç”¨__blockä¹‹åå°±æ˜¯blockæŒæœ‰äº†è¿™ä¸ªå¯¹è±¡,æ²¡æœ‰ä½¿ç”¨__blockçš„è¯åªæ˜¯copyäº†ä¸€ä»½,ä½†æ˜¯åªæœ‰åªè¯»æƒé™,ä¸èƒ½æ”¹å˜å¯¹è±¡,ä½†æ˜¯å¯ä»¥æ”¹å˜å¯¹è±¡çš„å±æ€§.

æ„æ€å°±æ˜¯æˆ‘çš„ä»£ç†æ¥äº†ä¸å¥½ä½¿,ä½ æ•¢åŠ¨æˆ‘å°å¼Ÿ.æˆ‘æ¥äº†ä½ è¿æˆ‘éƒ½æ•¢æ”¶æ‹¾å“ˆå“ˆ



</code></pre>





    </div>

    
</body>
</html>